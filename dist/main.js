(()=>{"use strict";class t{constructor(t,e,s,r){this.squares=[],this.width=t,this.height=e;const i=document.getElementById(s);for(let s=0;s<e;s++){const e=document.createElement("div");e.classList.add("row"),s==r&&(console.log("hello?"),e.classList.add("death-zone-boundary")),this.squares.push([]);for(let s=0;s<t;s++){const t=document.createElement("div");t.classList.add("square"),this.squares[this.squares.length-1].push(t),e.appendChild(t)}i.appendChild(e)}}setSquareColor({x:t,y:e,color:s}){const r=this.squares[e]?.[t];r&&(r.style.backgroundColor=s)}setAllSquaresColor(t){for(let e=0;e<this.height;e++)for(let s=0;s<this.width;s++)this.setSquareColor({x:s,y:e,color:t})}}function e(t){return t[(e=t.length,Math.floor(Math.random()*e))];var e}function s(t){const e=t.map((t=>t.x)),s=t.map((t=>t.y));return{x:(Math.min(...e)+Math.max(...e))/2,y:(Math.min(...s)+Math.max(...s))/2}}const r=[[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:1,y:1}],[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:3,y:0}],[{x:0,y:0},{x:1,y:0},{x:1,y:1},{x:2,y:1}],[{x:0,y:1},{x:1,y:1},{x:1,y:0},{x:2,y:0}],[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:2,y:1}],[{x:0,y:1},{x:1,y:1},{x:2,y:1},{x:2,y:0}]],i=["red","#00DD00","blue","yellow","cyan","magenta"];class o{constructor(){}next({gridWidth:t}){const o=e(i),n=e(r).map((t=>({...t,color:o}))),h=s(n);return n.map((e=>({...e,x:e.x-Math.floor(h.x)+Math.floor(t/2)})))}}new class{constructor(e,s){this.height=e,this.width=s,this.stepIntervalMillis=300,this.divGrid=new t(s,e,"grid",2),this.frozen=[],this.moving=[{x:2,y:2,color:"red"}],this.shapeGenerator=new o,this.score=0,this.scoreElement=document.getElementById("score"),this.scoreElement.innerHTML=this.score,this.lost=!1,document.addEventListener("keydown",(t=>this.onKeyPress(t)))}start(){this.moving=this.shapeGenerator.next({gridWidth:this.width}),this.startStepping()}onKeyPress(t){return"ArrowLeft"===t.key?this.goLeft():"ArrowRight"===t.key?this.goRight():"ArrowDown"===t.key?this.tryStep():"ArrowUp"===t.key?this.rotateRight():" "===t.key?this.drop():void 0}render(){this.divGrid.setAllSquaresColor("#000000");for(const t of this.frozen)this.divGrid.setSquareColor(t);for(const t of this.moving)this.divGrid.setSquareColor(t);this.scoreElement.innerHTML=this.score}startStepping(){this.tryStep(),setTimeout((()=>this.startStepping()),this.stepIntervalMillis)}tryStep(){this.canGo({dx:0,dy:1})?this.step():this.freeze()}canGo({dx:t,dy:e}){if(this.lost)return!1;for(const s of this.moving){if(s.y+e>=this.height)return!1;if(s.x+t>=this.width)return!1;if(s.x+t<0)return!1;if(this.frozen.some((r=>r.x===s.x+t&&r.y===s.y+e)))return!1}return!0}step(){for(const t of this.moving)t.y+=1;this.stepIntervalMillis/=1.0001,this.render()}freeze(){this.frozen.push(...this.moving),this.moving=this.shapeGenerator.next({gridWidth:this.width}),this.clearLines(),this.checkForLoss()}checkForLoss(){this.frozen.some((t=>t.y<2))&&(this.lost=!0,document.getElementById("loss-message").innerHTML="You lose!")}clearLines(){const t={};for(const e of this.frozen)t[e.y]?t[e.y]+=1:t[e.y]=1;let e=0;for(let s=this.height-1;s>=0;s--)if(t[s]&&t[s]>=this.width){this.frozen=this.frozen.filter((t=>t.y!=s+e));for(const t of this.frozen)t.y<s+e&&(t.y+=1);e+=1}this.score+=e}goLeft(){if(this.canGo({dx:-1,dy:0})){for(const t of this.moving)t.x-=1;this.render()}}goRight(){if(this.canGo({dx:1,dy:0})){for(const t of this.moving)t.x+=1;this.render()}}rotateRight(){const t=function(t){const e=(r=s(t),{...r,x:Math.round(r.x),y:Math.round(r.y)});var r;return console.log("centre",e),t.map((t=>{return function(t,e){return{...t,x:t.x+e.x,y:t.y+e.y}}(function(t){return{...t,x:t.y,y:-t.x}}((s=t,r=e,{...s,x:s.x-r.x,y:s.y-r.y})),e);var s,r}))}(this.moving);for(let e of t){if(e.x>=this.width)return;if(e.x<0)return;if(this.frozen.some((t=>t.x===e.x&&t.y===e.y)))return}this.moving=t,this.render()}drop(){for(;this.canGo({dx:0,dy:1});)this.tryStep()}}(24,10).start()})();